/*
 memebetter.com all rights reserved.
*/
(function(c,a,u,D){function R(){r.on({dragover:function(){a.dropzone.fadeIn(200);return!1},drop:function(b){a.dropzone.fadeOut(200);c(b.target).is("input[type=file]")||b.preventDefault()}});a.dropzone.on({dragover:function(){return!1},dragleave:function(){c(this).fadeOut(200);return!1},dragend:function(){c(this).fadeOut(200);return!1},drop:function(b){b.preventDefault();a.dropzone.fadeOut(200);"undefined"!=typeof b.originalEvent.dataTransfer.files[0]&&E(b.originalEvent.dataTransfer.files[0])}})}function F(b){var d=
a.context.font;a.context.font="60px monospace";var e=a.context.measureText("abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz").width;a.context.font="60px "+b+", monospace";b=a.context.measureText("abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz").width;a.context.font=d;return e!==b}function G(){var b=parseInt(.8*A.height(),10);200>b&&(b=200);a.A.css("max-height",b+"px")}function H(){a.context.textAlign="center";a.context.fillStyle="#FFF";a.context.lineStyle="#000";var b=((a.canvas.width>
a.canvas.height?a.canvas.height:a.canvas.width)+(a.canvas.width>a.canvas.height?a.canvas.width:a.canvas.height))/2,d=.014;500>b&&(d+=.005);a.fontSize=parseInt(a.K*b,10);a.context.font=a.fontSize+"pt "+a.fontFamily;a.context.lineWidth=parseInt(d*b,10);I.G={x:a.canvas.width/2,y:a.canvas.height/2}}function S(){var b=c("html");if(b.hasClass("no-canvas")&&b.hasClass("no-canvastext")||0<=navigator.userAgent.indexOf("Opera Mini"))b.addClass("app-nosupport"),b='<div class="panel"><h4>Sorry, your browser is unable to run the Meme Generator.</h4>',
navigator.userAgent.indexOf("Opera Mini")?b+="<p>Opera Mini is not compatible with our image manipulation techniques, please use the Android or Safari browser, Chrome, or Firefox mobile for the best experience with our meme generator.</p>":'<p>If possible, please do consider upgrading or installing a more recent browser. <a href="http://memebetter.com/faq#not-working-for-me">Learn more.</a></p>',b+="</div>",c(".no-support-message .error").append(b),c(".interface").hide();else{b.addClass("app-supported");
a.canvas=c("#rasterizer").get(0);a.context=a.canvas.getContext("2d");a.m=c("#first-line");a.p=c("#last-line");a.L=Hogan.compile(c("#memeChoiceTemplate").html());a.k=c("#meme-choices");a.M=c(".workspace");a.dropzone=c("#dropzone");a.I=c(".fileLoad");a.A=c("#rendered");a.g=c("#refresh-action");a.D=c(".pagination");a.u=c("#editor");a.j=c("#quicksearch");a.q=c(".meme-picker .alert-box");a.q.html('<i class="fa fa-exclamation-triangle"></i> Sorry, no images matched those keywords.');a.e=!1;a.browser=browserCheck();
a.h=c("button.live-mode");"undefined"!=typeof c.cookie("disable_refresh")&&c.cookie("disable_refresh")?J():a.h.attr("title",a.h.data("title-on"));T();x();a.k.on("click","img",U);r.on("click touchstart",".close",K).on("click touchstart",".text-form .close",function(){!0===t&&(v(),w())});for(var b=[],d=0;d<y.length;d++)b.push('"'+y[d].font+'"');a.fontFamily=b.join(", ");F("Impact")&&(a.H=!0);b=F(y[0].font)?0:1;a.K=y[b].w;a.J=y[b].lineHeight;A.resize(G);G();H();u.File&&u.FileList&&u.FileReader?(R(),
a.I.on("change",function(a){"undefined"!=typeof a.currentTarget.files[0]&&E(a.currentTarget.files[0])})):c(".requires-fileapi").hide()}}function C(b,d){for(var e=[],c=b.replace(/^\s+|\s+$/,"").replace(/\s\s*/g," ").split(" "),g=-1,m=0,f=a.context.measureText(" ").width,h=0;h<c.length;h++){var k=a.context.measureText(c[h]).width;if(k>d){var l=Math.floor(c[h].length/2),k=c[h].substr(0,l),l=c[h].substr(l),n=c.splice(0,h);c[0]=l;c.unshift(k+"-");c=n.concat(c);k=a.context.measureText(c[h]).width}if("undefined"==
typeof e[g]||m+f+k>d)g++,m=0,e[g]=[];e[g].push(c[h]);m=0===m?k:m+f+k}if(0<g)for(c=e.length-1;0<c;c--)for(g=c-1,m=e[g].length-1;0<m;m--)if(f=Math.abs(a.context.measureText(e[g].join(" ")).width-a.context.measureText(e[c].join(" ")).width),e[c].unshift(e[g].pop()),Math.abs(a.context.measureText(e[g].join(" ")).width-a.context.measureText(e[c].join(" ")).width)>=f){e[g].push(e[c].shift());break}return e}function K(b){b.preventDefault();c(b.currentTarget).parent().find("input").val("");!1!==t||a.g.is(":visible")||
a.g.fadeIn(300)}function L(b,d){a.context.save();a.context.setTransform(1,0,0,1,0,0);d=!0===d;var c=parseInt(.97*a.canvas.width,10),p=parseInt(a.fontSize,10)+"pt "+a.fontFamily;a.context.font=p;var g=C(b,c),f=g.length;if(1<g.length)for(var q=Math.ceil(g.length/2),h=1;4>h;h++)if(a.context.font=parseInt(a.fontSize*(1-.1*h),10)+"pt "+a.fontFamily,g=C(b,c),g.length<f)if(p=a.context.font,g.length===q)break;else--f;a.context.font=p;g=C(b,c);c=parseInt(a.context.measureText("M").width*a.J,10);p=d?c:parseInt(.97*
a.canvas.height-(g.length-1)*c,10);for(f=0;f<g.length;f++){var q=g[f].join(" "),h=I.G.x,k=p+f*c;if(a.H){var l=parseInt(a.context.lineWidth/2,10),n=a.context.fillStyle;a.context.fillStyle=a.context.lineStyle;a.context.fillText(q,h+l,k);a.context.fillText(q,h+l,k-l);a.context.fillText(q,h+l,k+l);a.context.fillText(q,h-l,k);a.context.fillText(q,h-l,k-l);a.context.fillText(q,h-l,k+l);a.context.fillText(q,h,k-l);a.context.fillText(q,h,k+l);2<l&&(a.context.fillText(q,h+l,k+2),a.context.fillText(q,h+l,k-
2),a.context.fillText(q,h-l,k+2),a.context.fillText(q,h-l,k-2));a.context.fillStyle=n}else a.context.strokeText(q,h,k);a.context.fillText(q,h,k)}a.context.restore()}function v(){var b=a.canvas.width,c=a.canvas.height;!1===f?a.context.fillRect(0,0,b,c):(5<=f.orientation&&8>=f.orientation&&(b=a.canvas.height,c=a.canvas.width),1>f.F?a.context.drawImage(f,0,0,f.width,f.height,0,0,b,Math.ceil(c/f.F)):a.context.drawImage(f,0,0,b,c));b=a.m.val().toUpperCase();c=a.p.val().toUpperCase();L(b,!0);L(c)}function J(){t=
!t;!0===t?(a.h.addClass("success").removeClass("secondary").attr("title",a.h.data("title-on")),c(".image-render").removeClass("manual"),a.g.fadeOut(300),c.removeCookie("disable_refresh"),w()):(a.h.addClass("secondary").removeClass("success").attr("title",a.h.data("title-off")),c(".image-render").addClass("manual"),c.cookie("disable_refresh","yes"))}function V(b){v();var d=new Date,d="memebetter.com-"+(""+d.getFullYear()+("0"+(d.getMonth()+1)).slice(-2)+("0"+d.getDate()).slice(-2)+("0"+d.getHours()).slice(-2)+
("0"+d.getMinutes()).slice(-2)+("0"+d.getSeconds()).slice(-2))+".jpg";c(b.target).attr("href",a.canvas.toDataURL("image/jpeg")).attr("download",d);r.triggerHandler("saveImage")}function w(){var b=a.A;0===b.length&&(b=c('<img id="rendered" />'),c(a.canvas).parent().append(b),a.A=c("#rendered"));b.get(0).src=a.canvas.toDataURL("image/jpeg");a.M.show()}function W(){a.u.is(":visible")?c.scrollTo(0,{duration:400}):a.u.slideDown(200,function(){c.scrollTo(0,{duration:400})})}function U(b){var d=a.e;a.e=
c(b.target);d&&d.removeClass("active");a.e.addClass("active");if(d&&a.m.val()==d.data("prefill-first")&&a.p.val()==d.data("prefill-last")||0===a.m.val().length&&0===a.p.val().length)a.m.val(a.e.data("prefill-first")),a.p.val(a.e.data("prefill-last"));b=a.e.data("url");d=new Image;d.orientation=1;d.onload=M;f=d;f.src=b;r.triggerHandler("memeSelection")}function M(){if(0!==f.height&&0!==f.width){var b=f,c=f,e=f.height,p=D.createElement("canvas");p.width=1;p.height=e;p=p.getContext("2d");p.drawImage(c,
0,0);for(var c=p.getImageData(0,0,1,e).data,p=0,g=e,m=e;m>p;)0===c[4*(m-1)+3]?g=m:p=m,m=g+p>>1;e=m/e;b.F=0===e?1:e;b=f.width;e=f.height;5<=f.orientation&&8>=f.orientation&&(b=f.height,e=f.width);if(800<e||800<b)c=e/b,e===Math.max(b,e)?(e=800,b=parseInt(e/c,10)):(b=800,e=parseInt(b*c,10));if(a.canvas.height!=e||a.canvas.width!=b)a.canvas.height=e,a.canvas.width=b,H();a.context.setTransform(1,0,0,1,0,0);switch(f.orientation){case 2:a.context.translate(b,0);a.context.scale(-1,1);break;case 3:a.context.translate(b,
e);a.context.rotate(Math.PI);break;case 4:a.context.translate(0,e);a.context.scale(1,-1);break;case 5:a.context.rotate(.5*Math.PI);a.context.scale(1,-1);break;case 6:a.context.rotate(.5*Math.PI);a.context.translate(0,-b);break;case 7:a.context.rotate(.5*Math.PI);a.context.translate(e,-b);a.context.scale(-1,1);break;case 8:a.context.rotate(-.5*Math.PI),a.context.translate(-e,0)}}a.g.hide();v();w();W()}function E(b){if(-1!==b.type.indexOf("image")){var c=new FileReader;c.onloadend=function(a){if(a.target.readyState==
FileReader.DONE){a=a.target.result;var b=atob(a.split(",")[1]),b=EXIF.readFromBinaryFile(new BinaryFile(b,0,b.length)).Orientation||1,c=new Image;c.orientation=b;c.onload=M;f=c;f.src=a}};c.readAsDataURL(b);r.triggerHandler("customImage");a.e&&(a.e.removeClass("active"),a.e=!1)}}function X(){r.on("click","button",function(a){a.preventDefault()}).on("click touchend","#rendered, #refresh-action",function(){a.g.fadeOut(300);v();w()}).on("keyup","#first-line, #last-line",function(b){27===b.keyCode?K(b):
!0===t||13===b.keyCode?(v(),w()):a.g.is(":visible")||a.g.fadeIn(300)}).on("click",".live-mode",function(){J();t?_gaq.push(["_trackEvent","Config","Auto Refresh","Enable"]):_gaq.push(["_trackEvent","Config","Auto Refresh","Disable"]);v();!0===t&&w()}).on("click",".pick-image",function(){a.u.slideUp()}).on("click",".save-image",V).on("click",".meme-picker .close",function(a){c("#quicksearch").val("");a.preventDefault();x(a)}).on("keyup","#quicksearch",x).on("blur","#quicksearch",function(){3<=c.trim(a.j.val()).length&&
r.triggerHandler("search")}).on("click",".pagination .arrow, .pagination .page",Y).on("click",".view-all",function(){z=200;n=1;c(".pagination").remove();c(".view-all [data-alt]").each(function(){var a=c(this);a.attr("class",a.data("alt"))});_gaq.push(["_trackEvent","Navigate","View All"]);x()}).on("memeSelection",function(){_gaq.push(["_trackEvent","Meme","Pick",a.e.attr("title")])}).on("customImage",function(){_gaq.push(["_trackEvent","Meme","Load Custom"])}).on("saveImage",function(){var b=["_trackEvent",
"Meme"];a.e?(b.push("Save"),b.push(a.e.attr("title"))):b.push("Save Custom");_gaq.push(b)}).on("paginationChange",function(){_gaq.push(["_trackEvent","Navigate","Pagination","Page "+n])});if("yes"!==navigator.doNotTrack&&1!==navigator.doNotTrack)r.on("search",function(){var b=["_trackEvent","Navigate"];0<a.k.find(".meme-choice").length?b.push("Search Hit"):b.push("Search Miss");b.push(a.j.val());_gaq.push(b)});c.cookie.defaults.expires=365}function Y(b){b.preventDefault();b=c(b.target);b.hasClass("next")?
n+1<=B&&(n+=1):b.hasClass("prev")?1<=n-1&&--n:(b=parseInt(b.text(),10),b!=n&&(n=b));var d,e;4<n?(e=Math.min(B,n+1),d=e-6+1):(d=1,e=6);b=c(".pagination");b.find(".page:lt("+(d-1)+")").hide();b.find(".page:gt("+(d-1)+"), .page:eq("+(d-1)+")").show();b.find(".page:gt("+(e-1)+")").hide();d=a.j;e=A.scrollTop();var f=e+A.height(),g=d.offset().top;g+d.height()<=f&&g>=e||c.scrollTo(a.j);c(".pagination .current").removeClass("current");b.find("li:eq("+n+")").addClass("current");r.triggerHandler("paginationChange");
x()}function N(b){if(c.isArray(b))c.each(b,function(a,b){var c=b.find("img:not([src])");c.attr("src",c.data("src"))});else{var d=b.find("img:not([src])");d.attr("src",d.data("src"))}a.k.append(b)}function x(b){"undefined"!=typeof b&&27===b.keyCode&&a.j.val("");var d=c.trim(a.j.val()),e=[];if(3<=d.length||d.match(/\d{2,}/)){a.D.hide();for(var f=O(d),f=3>f.length?!1:f.split(" "),g=0;g<a.l.length;g++){var m=0,m=f&&Z(f,a.C[g])?Math.min(.5+.1*f.length,.9):a.B[g].score(d);.35<=m&&e.push([g,m])}e.sort(function(a,
b){return b[1]-a[1]});e.length?a.q.hide():a.q.show();a.k.empty();d=Math.min(e.length,z);for(f=0;f<d;f++)N(a.l[e[f][0]]);1===e.length&&"undefined"!=typeof b&&13===b.keyCode&&a.l[e[0][0]].find("img").click()}else a.D.show(),a.q.hide(),a.k.empty(),N(a.l.slice((n-1)*z,n*z))}function O(a){return a.toLowerCase().replace(/[^a-z0-9 ]/g,"").split(" ").sort().filter(P).join(" ")}function Z(a,c){for(var e=-1,f=-1,g=0,m=a.length;g<m;++g)if(e=c.indexOf(a[g],f),0<=e&&e>f)f=e;else return!1;return 0<=e}function P(a,
c,e){return-1===e.indexOf(a,c+1)}function T(){a.l=[];a.B=[];a.C=[];Q=a.a.images.length;B=Math.ceil(Q/z);c(".pagination .page").remove();for(var b=1;b<=B;b++){var d=c('<li class="page"><a href="">'+b+"</a></li>");d.data("pagingNum",b);6<=b-1&&d.hide();1===b&&d.addClass("current");c(".pagination .next").parent().before(d)}for(b=0;b<a.a.images.length;b++){d=c.trim(a.a.images[b].title).split(" ");a.a.images[b].keywords&&a.a.images[b].keywords.length&&(d=d.concat(c.trim(a.a.images[b].keywords).split(" ")));
"undefined"!=typeof a.a.images[b].prefill&&("string"==typeof a.a.images[b].prefill.first&&(d=d.concat(c.trim(a.a.images[b].prefill.first).split(" "))),"string"==typeof a.a.images[b].prefill.last&&(d=d.concat(c.trim(a.a.images[b].prefill.last).split(" "))));var d=d.filter(P),e={src:a.a.base+a.a.images[b].src,thumbnail:a.a.base+a.a.images[b].src.split(/\.[a-z]{3}/)[0]+"_t.jpg",name:a.a.images[b].title};"undefined"!=c.type(a.a.images[b].prefill)&&("string"==c.type(a.a.images[b].prefill.first)&&(e["prefill-first"]=
a.a.images[b].prefill.first),"string"==c.type(a.a.images[b].prefill.last)&&(e["prefill-last"]=a.a.images[b].prefill.last));e=c(a.L.render(e));a.l[b]=e;a.B[b]=d.join(" ");a.C[b]=O(d.join(" "))}}var t=!0,f=!1,y=[{font:"Impact",w:.08,lineHeight:1.4},{font:"Passion One",w:.11,lineHeight:1.15},{font:"sans-serif",w:.11,lineHeight:1.15}],I={},z=12,n=1,Q,B,r=c(D),A=c(u);c.MemeGenerator=function(b){a.a=b||{};"undefined"===typeof u._gaq&&(u._gaq=[]);r.ready(S);b=r.find("body");c.browser.mobile?b.addClass("is-mobile"):
b.addClass("is-desktop");X()}})(jQuery,{},window,document);
